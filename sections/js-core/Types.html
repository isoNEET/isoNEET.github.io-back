<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2. 深入型別系統 - Study Notes</title>

        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/atom-one-dark.min.css">
        <!-- Custom theme stylesheets -->

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">yhchen.space</li><li class="chapter-item expanded "><a href="../../introduce.html"><strong aria-hidden="true">1.</strong> Introduce</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> 開發工具</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../sections/tools/git.html"><strong aria-hidden="true">2.1.</strong> Git</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> Visual Studio Code</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">WEB 相關知識</li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> </div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../sections/related-work/API.html"><strong aria-hidden="true">3.1.</strong> API 與 RESTful API</a></li><li class="chapter-item expanded "><a href="../../sections/related-work/URL.html"><strong aria-hidden="true">3.2.</strong> URL</a></li><li class="chapter-item expanded "><a href="../../sections/related-work/HTTP.html"><strong aria-hidden="true">3.3.</strong> HTTP 協定</a></li><li class="chapter-item expanded "><a href="../../sections/related-work/Secure.html"><strong aria-hidden="true">3.4.</strong> 網頁的基礎安全</a></li><li class="chapter-item expanded "><a href="../../sections/related-work/CSR_SSR.html"><strong aria-hidden="true">3.5.</strong> 客戶端與伺服端渲染</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">JavaScript Core</li><li class="chapter-item expanded "><a href="../../sections/js-core/Overview.html"><strong aria-hidden="true">4.</strong> 概觀</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../sections/js-core/Syntax.html"><strong aria-hidden="true">4.1.</strong> 1. 語法速覽</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/Types.html" class="active"><strong aria-hidden="true">4.2.</strong> 2. 深入型別系統</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/Object.html"><strong aria-hidden="true">4.3.</strong> 3. 物件與類別</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/JS-Arch.html"><strong aria-hidden="true">4.4.</strong> 4. JS引擎架構</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/Asynchronous.html"><strong aria-hidden="true">4.5.</strong> 5. 非同步程式設計</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/Common-skill.html"><strong aria-hidden="true">4.6.</strong> 6. 常用技巧與函數</a></li><li class="chapter-item expanded "><a href="../../sections/js-core/Conclusion.html"><strong aria-hidden="true">4.7.</strong> 7. 總結</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> 附錄</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../appendix/es5-class.html"><strong aria-hidden="true">5.1.</strong> ES5 Class</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Study Notes</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="型別系統"><a class="header" href="#型別系統">型別系統</a></h1>
<p>在該章節中，深入一點JavaScript中的型別系統</p>
<p>在 JavaScript 中，可以分成基礎型別(或稱原始型別)與複合型別</p>
<p>基礎的 7 種型別分別為</p>
<ul>
<li>Null</li>
<li>Undefined</li>
<li>Boolean(true, false)</li>
<li>Number</li>
<li>Bigint</li>
<li>String</li>
<li>Symbol</li>
</ul>
<p>複合型別包含了</p>
<ul>
<li>Function</li>
<li>Object</li>
</ul>
<p>快速理解 JavaScript 中的型別系統</p>
<hr />
<p>對於 Boolean、Number、String 這幾個型別可以用很簡單的方式說明</p>
<p>Boolean 即為 <code>false</code>、<code>true</code> 兩個字面值</p>
<p>Number 則是相當於C++的double值<code>(-(2^53-1) ~ 2^53 - 1)</code>的數值。除了這個範圍的數值中，還包含了<code>Infinity</code>、<code>-Infinity</code>、<code>NaN</code> 三個數值。<code>Infinity</code>、<code>-Infinity</code> 相當於正負無限
<code>NaN</code> 則是代表 <code>Not a Number</code>，通常會出現在不合法的運算，例如</p>
<pre><code class="language-js">let result = &quot;string&quot; - 100; // NaN
let result2 = &quot;test&quot; * 100   // NaN
let value1 = 100 / 0         // Infinity
let value2 = Math.log(0)     // -Infinity
typeof result === &quot;number&quot;   // true
</code></pre>
<p>請注意，&quot;不合法的運算&quot;是指，使用非&quot;number&quot;型別的運算子進行運算，並非是指 <code>100 / 0</code> 這種運算錯誤
此外， <code>NaN</code> 意思雖然是 <code>Not a Number</code> ，但是型別是 <code>number</code> 若要正確檢測 <code>NaN</code> 的型別，請使用 <code>isNaN()</code> 函式</p>
<p>String 則是指使用 <code>''</code>、<code>&quot;&quot;</code>、以及<code>``</code>所包覆起來的文字，<code>'string'</code> 與 <code>&quot;string&quot;</code> 還有 `string` 三者是同義的，而第三種以(``)則是樣板字串(Template String)，可以嵌入變數</p>
<pre><code class="language-js">let name = &quot;username&quot;
let str = `Hello, ${name}`

console.log(str) // &quot;Hello, username&quot;

// 等價以下語法：
let str_ = 'Hello, ' + name;

// 允許巢狀嵌入
let condtion = false;
let val1 = &quot;a1234567&quot;;
let val2 = &quot;b24681357&quot;;
let output = `condtion output: ${condtion ? `val1=${val1}` : `val2=${val2}`}`;
console.log(output) // &quot;condtion output: val2=b24681357&quot;
</code></pre>
<p>Bigint 則是大數型別，在數字後加上<code>n</code>，轉型為大數型別。當數字超過一定的範圍，會用字串型別進行處理，而Bigint提供了很基礎的運算：</p>
<pre><code class="language-js">let val1 = 2 ** 2000 // value out of number range: &quot;Infinity&quot;
let val2 = 2n ** 2000n /*
114813069527425452423283320117768198402231770208869520047764273682576626139237031385
665948631650626991844596463898746277344711896086305533142593135616665318539129989145
312280000688779148240044871428926990063486244781615463646388363947317026040466353970
904996558162398808944629605623311649536164221970332681344168908984458505602379484807
914058900934776500429002716706625830522008132236281291761267883317206598995396418127
021779858404042159853183251540889433902091920554957783589672039160081957216630582755
380425583726015528348786419432054508915275783882625175435528800822842770817965453762
184851149029376 */
</code></pre>
<p>Symbol 是個稍微複雜的型別，通常用來建立一個獨特的 Key 值，並作為物件中的成員值
更具體的細節請參考 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">Symbol</a></p>
<p>而關鍵字 <code>typeof</code> 則是列出運算式的型別，其回傳值必定是以下幾個字串：</p>
<ul>
<li>&quot;bigint&quot;</li>
<li>&quot;boolean&quot;</li>
<li>&quot;function&quot;</li>
<li>&quot;number&quot;</li>
<li>&quot;object&quot;</li>
<li>&quot;string&quot;</li>
<li>&quot;undefined&quot;</li>
</ul>
<p>其中要注意的是，<code>typeof null</code>的回傳結果是 <code>object</code>， <code>typeof NaN</code>的回傳結果是 <code>number</code></p>
<h2 id="複合型別"><a class="header" href="#複合型別">複合型別</a></h2>
<p><code>Object</code> 與 <code>Function</code> 是複合型別，嚴格來說，僅有 Object 型別才對</p>
<p>先從 Object 開始提起：
在 JavaScript 中， Object &quot;模擬&quot;成 C++ 的類別，但是又有點不太相同
在JavaScript中，物件的實現方法稱為 &quot;原型鏈&quot; 或是繼承鏈，這裡用 C++ 的 Virtual Function 來說明:</p>
<p><img src="./images/virtual-table.png" alt="virtual-table" /></p>
<p>倘若 D1 與 D2 皆繼承了 Base Class，當調用 <code>D1.function1</code> 或是 <code>D2.function2</code>，會先嘗試尋找類別本身的定義，倘若本身無定義的話；會嘗試調用 Base 上的定義
這與 JavaScript 物件的行為十分類似，在JavaScript 存在著所謂原型鏈的定義。先看看早期的JavaScript</p>
<pre><code class="language-js">/* Define Class, JavaScript 5 */
function User(name, job) {
  if(!(this instanceof User)) {
    throw new Error(&quot;User should use `new` to create Object&quot;);
  }
  this.name = name;
  this.job = job;
}

User.prototype.intro = function(){
  console.log(&quot;My name is &quot; + this.name + &quot; , is a &quot; + this.job);
}

var user = new User('Alex', 'student');
user.intro(); // &quot;My name is Alex , is a student&quot;
user.intro = function(){
  console.log(&quot;[&quot; + this.name + &quot;, &quot; + this.job + &quot;]&quot;);
}
</code></pre>
<p>請注意 <code>prototype</code> 這個屬性，可以把該屬性當成 <code>Virtual Member Table</code>，當調用 <code>user.intro</code> 時，
會依序檢查 <code>user.intro</code> &gt; <code>user.prototype.intro</code> &gt; <code>Object.prototype</code>
對於所有 JavaScript 物件，都是繼承自 <code>Object.prototype</code></p>
<p>在以前沒有 <code>class</code> 關鍵字時，是使用 <code>function</code> 作為函式定義，所以需要使用 <code>this instanceof [FunctionName]</code> 來檢查是調用 <code>User()</code> 還是 <code>new User</code>
關於更多類別的說明，會在下個章節中說明</p>
<p><strong>Note!</strong> Virtual Table的說明僅是舉例，內部如何實作未必如此</p>
<h2 id="深拷貝與淺拷貝"><a class="header" href="#深拷貝與淺拷貝">深拷貝與淺拷貝</a></h2>
<p>對於物件的比較，須注意不能用一般的方式進行比較，這是因為物件的行為比較接近C++中的指標/參考</p>
<p>舉例來說：</p>
<pre><code class="language-js">
let arr0 = new Array() // 補充一下，可以使用 new 來建立陣列
let arr1 = [1,2,3,4];  // 若使用 [] 和 {} 來建構陣列或物件，這種作法稱為字面值(Literal Value)宣告
let arr2 = [1,2,3,4];
let arr3 = arr2
arr1 === arr2 // false
arr3 === arr2 // true
</code></pre>
<p>在該例子中，<code>arr1</code> 與 <code>arr2</code> 有著一樣的成員，比較結果卻是 <code>false</code>
反之，<code>arr2</code>和<code>arr3</code> 的比較結果是 <code>true</code>。起初會有些疑惑，但是用等效的C++程式碼說明：</p>
<pre><code class="language-cpp">int* arr1 = new int(4);
int* arr2 = new int(4);
int* arr3 = arr1;
arr1 === arr2 // false(因為 address 不同)
arr3 === arr2 // true(因為 address 相同)
</code></pre>
<p>這可以說明JavaScript中物件的作法，是比較接近指標，但是看起來卻像是參考，比方說</p>
<pre><code class="language-js">function append(arr, value) {
  arr.push(value);
}

let x = [];
append(x, 100);
console.log(x) // [100]
let y = x;
append(y, 200);
console.log(x) // [100, 200]
</code></pre>
<p>當第一次調用 append 時，會把 x 的位址傳入 append；因此外部的 x 被修改了</p>
<p>接下來把 y 指向 x，然後調用<code>append(y, 200)</code>，再次檢查 x 的值，會發現 x 值再次被修改了</p>
<p>對於第二次 <code>append</code>，可以看做 append 內部的 <code>arr 指向 y，y 又指向 x</code>，因此才會被修改</p>
<p>淺拷貝的意思是：<code>不同物件的成員，擁有相同的參考</code>，即為淺拷貝。舉例來說</p>
<pre><code class="language-js">let Parent = {
  arr: [0,1,2,3,4]
};

let ChildA = {
  arr: Parent.arr
};

let ChildB = {
  arr: Parent.arr
};
// ChildA.arr === ChildB.arr
</code></pre>
<p>在這種情況下，因為已經有指標的概念了，所以會注意到 <code>arr: Parent.arr</code> 把同一個物件指定給 ChildA 跟 ChildB 了</p>
<p>若你對 JavaScript 有點概念，可能知道 Object 可以使用 <code>Parent.arr</code> 或是 <code>Parent[&quot;arr&quot;]</code> 的方式使用成員，因此你有可能誤用</p>
<pre><code class="language-js">function clone(source, target) {
  for(const [key, value] of Object.entries(source) ) {
    target[key] = value;
  }
}

let ChildC = {};
let ChildD = {};
clone(Parent, ChildC);
clone(Parent, ChildD);
ChildC === ChildD // false
ChildC.arr === ChildD.arr // true
</code></pre>
<h2 id="深拷貝"><a class="header" href="#深拷貝">深拷貝</a></h2>
<p>深拷貝的定義相對單純，可以解釋為<code>不同物件的成員，都擁有不同的參考</code>
以上面的定義，若要複製 array，有幾種方法：</p>
<pre><code class="language-js">let arr = [0,1,2,3,4];

// sol1?
function clone(source) {
  let temp = [];
  for(const value of source)
    temp.push(value);
  return temp;
}
let arr1 = clone(arr);

// sol2?
let arr2 = [...arr];

// sol3?
let arr3 = arr.map(e =&gt; e);

//sol4:
let arr4 = JSON.parse(JSON.stringify(arr));

// arr1 ~ arr4 的值皆為 [0,1,2,3,4]，且都不等於 arr
</code></pre>
<p>但是請注意，倘若陣列中的值是物件，比方說<code>[{}, {}, {}, {}]</code>，那麼 arr1 ~ arr4 雖然互不相等</p>
<p>但是 <code>arr1[0]、arr2[0]、arr[0]</code> 都會等於 <code>arr[0]</code>，因為他們內部都是指向 arr[0]</p>
<p>而 arr4 則是<strong>完全複製</strong>，也就是說進行<code>arr4[0].x = 100</code> 這種修改，是不會影響到<code>arr[0]</code>的</p>
<p>因此，僅有 sol4 才算是深拷貝，因為他是先把物件進行 JSON 的序列化，在反序列化回來</p>
<p>這種作法無法複製function(JSON.stringify 不會轉譯function)，也不會複製<code>undefined</code></p>
<p>通常深拷貝的使用次數不多，且都有Library可以處理，因此只要有概念即可</p>
<h2 id="型別間的比較"><a class="header" href="#型別間的比較">型別間的比較</a></h2>
<p>在前面幾個章節，會發現交錯使用 <code>==</code> 和 <code>===</code>，有些人會說 <code>===</code> 指的是嚴格比較，該說法有點道理，但是實際上更單純</p>
<p>先從 JavaScript 的運算子說明，每個運算子都會定義兩邊的運算元型別，而JavaScript有個轉換的優先順序：</p>
<pre><code class="language-js">/* '+' 運算子可以用在 string + string 或是 number + number */
let a = 'str' + 'ing' //string
let b = 1 + 2 // 3
let c = '200' + 100 // string 的優先度高於 number，先把 100 轉為 '100'，然後相加字串
c // '200100'

/* '-' 運算子僅能用在 number + number */
let d = '1000' - 100 // - 僅接受兩個 number，嘗試把 '1000'轉為 1000，然後相減
d // 900
let e = '100a' - 100 // '100a' 無法轉換為 number，該計算結果為 NaN
</code></pre>
<p>那麼回到 <code>==</code> 和 <code>===</code>， <code>==</code> 的語意是<strong>比較時，允許型別轉換</strong>；<code>===</code> 的語意則是 <strong>比較時，不允許型別轉換</strong></p>
<p>大致上來說，轉換的順序可以看成 string &gt; number &gt; boolean，當運算元是不同型別的時候，會向上轉換一階：</p>
<pre><code class="language-js">console.log(true == 1) // true
console.log(true == 'true') // false

/* 分析一下 true == 'true' 這個例子 */
console.log(true == 1) // 代表 Number(true) 會轉成 1
console.log('1' == 1)  // 代表 String(1) 會轉成 '1'
console.log(true == '1') // true，左側進行 String(Number(true)) 得到 '1'
</code></pre>
<p>但凡事都存在例外，<strong>物件</strong>可以定義 toString 以及 toJSON，來決定被轉換成 <code>string</code> 和 <code>JSON</code> 的方法
Object 的轉換都會直接<strong>隱式</strong>調用 <code>obj.toString()</code> 方法</p>
<pre><code class="language-js">let obj = {};

obj == 10000 // false，因為 obj 會轉換成 '[object Object]'，此時變成 compare(string, number)
//於是 10000 會進行 String(10000) 得到 '10000'，而 '[object Object]' 不相等於 '10000'

let objA = {};
objA == '[object Object]' // true

// 手動定義 toString 方法
objA.toString = function(){
  return 10000
}

objA == 10000 // true
</code></pre>
<p>而 <code>===</code> 和 <code>!==</code> 就是告知JS引擎，比較時不允許隱式轉換型別</p>
<h2 id="深入理解"><a class="header" href="#深入理解">深入理解</a></h2>
<p><img src="./images/wtfjs.png" alt="meme" /></p>
<p>由左至右，由上至下來說明這個梗圖：</p>
<h3 id="typeof-nan"><a class="header" href="#typeof-nan">typeof NaN</a></h3>
<p><code>typeof NaN</code> 前有說明，NaN 定義於 IEEE 754，表示無效操作(不等同於算數溢位)，但是沒有特別定義 NaN 是否為 number
在JS中，使用 isNaN 來檢測 <code>NaN</code> 值</p>
<h3 id="9999999999999999"><a class="header" href="#9999999999999999">9999999999999999</a></h3>
<p>9999999999999999 == 10000000000000000 是浮點數的誤差</p>
<h3 id="0501--0102"><a class="header" href="#0501--0102">0.5+0.1 , 0.1+0.2</a></h3>
<p>僅出現在 0.1 + 0.2 的時候，浮點數會出現誤差，
而 0.5 + 0.1 並不會，這也是 IEEE 754 的錯誤，高精度比較法可以用</p>
<pre><code class="language-js">function equal(a, b) {
  let value = Math.abs(a - b);
  return value &lt; 1e-15;
}

equal(0.1+0.2 , 0.3) // true
</code></pre>
<p>其中 <code>1e-15</code> 是可以自行定義的門檻值，核心作法為&quot;當計算結果小於一個誤差值，視為相同&quot;</p>
<h3 id="mathmax--mathmin"><a class="header" href="#mathmax--mathmin">Math.max , Math.min</a></h3>
<p><code>Math.max</code> 的簽章是 <code>Math.max(n1, n2, n3, ...)</code> 會回傳參數中的最大數值
他內部的實作類似：</p>
<pre><code class="language-js">Math.max = function(...args) {
  let currentValue = -Infinity;
  for(const value of args) {
    if(value &gt; currentValue)
      currentValue = value;
  }
  return currentValue;
}
</code></pre>
<p>照圖上的 <code>Math.max()</code>，沒有傳入參數的話，會導致 for-loop 不進行疊代，所以直接回傳<code>currentValue</code>，也就是 -Infinity
<code>Math.min</code>的狀況類似，只是 <code>if</code> 判斷改成 <code>value &lt; currentValue</code></p>
<h3 id="--------"><a class="header" href="#--------">[ ]+[ ], [ ]+{ }, { }+[ ]</a></h3>
<p><code>[] + []</code>，在陣列中，轉換為 string 實際上是調用了 <code>join</code> 這個方法，因此</p>
<pre><code class="language-js">let arr = [1,2,3,4,5,6,7];
arr == arr.join(); // true
arr.join() // '1,2,3,4,5,6,7'

arr == arr.join(' '); // false
arr.join(' ') //1 2 3 4 5 6 7
</code></pre>
<p><code>join(token)</code> 的作法是先把陣列的所有元素轉換為 <code>string</code> 型別，再透過 token 連接起來</p>
<p><code>[] + {}</code> 則是如同前面說的，會先把 <code>[]</code> 轉換成 <code>''</code>，然後把 <code>{}</code> 轉換成 <code>'[object Object]'</code>再把 <code>'' + '[object Object]'</code> 字串合併得到 <code>'[object Object]'</code></p>
<p><code>{} + []</code> 為0比較特殊，因為 <code>{}</code> 不可進行估算，所以實際上會看成 <code>{} (+[])</code>，而<code>+[]</code> 會轉成 0，然後進行 <code>{} 0</code> 得出0
這看起來是這個奇怪的結果？首先要知道JS引擎首次估算是用直譯的，所以可能的過程是：</p>
<pre><code class="language-js">// {} 0 改寫成
{
  /* empty scope */
}
0
</code></pre>
<p>換句話說，<code>{} + []</code>前面的<code>{}</code> <strong>不是物件</strong>，而是當成scope的宣告；接下來後面接一個數值，因此得出 0</p>
<p>證據就是，<code>()</code>不允許定義scope，倘若改成 <code>({}) + []</code> 就會視作兩個值進行<code>+</code>運算，所以會轉換成 <code>'[object Object]' + ''</code>，<code>({}) + []</code> 就會等同 <code>[] + {}</code></p>
<h4 id="truetruetrue-true-true-true1-true-1"><a class="header" href="#truetruetrue-true-true-true1-true-1">true+true+true, true-true, true==1, true ===1</a></h4>
<p>先理解成</p>
<ol>
<li><code>true</code> 會轉為 Number 1</li>
<li><code>==</code> 會進行型別轉換；<code>===</code>不會轉換</li>
<li>boolean 會先嘗試轉換為 <code>number</code>，然後是 <code>string</code></li>
</ol>
<h4 id="length"><a class="header" href="#length">(!+[]+[]+![]).length</a></h4>
<p><code>(!+[]+[]+![]).length</code>
先拆解成</p>
<ol>
<li><code>!(+[])</code> - <code>+[]</code>會變成 <code>+''</code>，然後轉為 0，!0 會轉為 <code>true</code></li>
<li><code>[]</code> - 轉換成 <code>''</code></li>
<li><code>![]</code> - <code>[]</code> 轉換成 <code>true</code>，然後運算<code>!true</code> 得到 <code>false</code></li>
</ol>
<p>三個值相加得到 <code>'truefalse'</code>，該字串長度為 <code>9</code></p>
<h4 id="91-91-1"><a class="header" href="#91-91-1">9+&quot;1&quot;, 91-&quot;1&quot;</a></h4>
<p>請看上面章節<a href="#%E5%9E%8B%E5%88%A5%E9%96%93%E7%9A%84%E6%AF%94%E8%BC%83">型別間的比較</a></p>
<h4 id="17"><a class="header" href="#17">17</a></h4>
<p><code>[] == 0</code> 因為 Number([]) 轉換成 0， 0 == 0 得到 <code>true</code></p>
<h2 id="章節回顧"><a class="header" href="#章節回顧">章節回顧</a></h2>
<p>該章節要描述的概念是 JavaScript 中的型別系統，倘若你是初學者，會不太理解為什麼他表現的狀況跟你想的不一樣</p>
<ul>
<li>理解 JavaScript 中的型別</li>
<li>理解Object、Function是使用類似 reference 的方式做傳遞</li>
<li>知道<strong>深拷貝與淺拷貝</strong>的意義(非常重要)</li>
<li>比較(==) 和 嚴格比較(===) 兩個運算子的意義</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../sections/js-core/Syntax.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../sections/js-core/Object.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../sections/js-core/Syntax.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../sections/js-core/Object.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
